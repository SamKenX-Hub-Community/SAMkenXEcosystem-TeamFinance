
<!DOCTYPE html>

<html lang="en">

<head>

 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="ie=edge">

 <title>TradeFinance Smart Contract</title>

 <link rel="stylesheet" type="text/css" href="TradeFinanceHome.css">

 <style type="text/css">

body {
    background-color:#F0F0F0;
    padding-top: 1em;
    font-family: �Raleway�,�Source Sans Pro�, �Arial�;
}

input[type=text], input[type=password] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

@-webkit-keyframes animatezoom {
  from {-webkit-transform: scale(0)} 
  to {-webkit-transform: scale(1)}
}
  
@keyframes animatezoom {
  from {transform: scale(0)} 
  to {transform: scale(1)}
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
  span.psw {
     display: block;
     float: none;
  }
  .cancelbtn {
     width: 100%;
  }
}
 </style>

</head>


<body>

    <script src="./UserAuthentication.js"></script>

    <div class="header">

        <a class="Header-Home" href="./TradeFinanceHome.html">TradeFinanceHome</a>

        <div class="NavigationBar" id="Navigation-bar">

            <div class="Login_NavigationBar" id="Login-Navigation-bar">

                <a class="Login" onclick="document.getElementById('Login-Popup').style.display='block'" href="#">Login</a>&nbsp;
                <a class="SignUp" onclick="document.getElementById('Signup-Popup').style.display='block'" href="#">SignUp</a>&nbsp;

            </div>

            <div class="Content_NavigationBar" id="Content-Navigation-bar">

                <a class="Buyer" id="Buyer-Link" href="./TradeBuyer.html">Buyer</a>
                <a class="Buyer-Bank" id="Buyer-Bank-Link" href="./TFBuyerBank.html">Buyer-Bank</a>
                <a class="Seller" id="Seller-Link" href="./TradeSeller.html">Seller</a>
                <a class="Contact-Info" id="Contact-Info-Link" href="./TFContactInfo.html">Contract-US</a>
                <button type="button" class="logout_button" id="logout-button" onclick='UserAuthenticationModule.processLogOffEvent(event);'>Logout</button>

            </div>

        </div>

    </div>

    <div id="Login-Popup" class="modal">

        <!--form class="modal-content animate" action="/action_page.php"-->
        <form class="modal-content animate">

            <div class="imgcontainer">
                <span onclick="document.getElementById('Login-Popup').style.display='none'" class="close" title="Close Modal">&times;</span>
                <img src="login-icon.jpg" alt="Avatar" class="avatar">
            </div>

            <div class="input-details-container">

                <label for="uname"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" name="uname" required id="Authentication-UserName">

                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" name="psw" required id="Authentication-Password">

            </div>

            <div class="passwordControlsContainer" style="background-color:#f1f1f1">

                <label class="buffer-clearance"></label>
                <label class="remember-password-label">
                    <input type="checkbox" name="rememberPassword" class="remember-password-checkbox"> Remember me
                </label>
                <label class="buffer-clearance"></label>
                <span class="forgot-Password-Link"> <a href="#">Forgot password?</a></span>

            </div>

            <label class="bottom-buffer-clearance"></label>

            <div class="loginControlsContainer">

                <label class="buffer-clearance" id="Login-Button"></label>
                <button type="button" class="loginbtn" onclick='processUserAuthentication(event);'>Login</button>
                <label class="buffer-clearance"></label>
                <button type="button" onclick="document.getElementById('Login-Popup').style.display='none'" class="cancelbtn_loginpage">Cancel</button>

            </div>

            <label class="bottom-buffer-clearance"></label>

        </form>

    </div>

    <div class="container" style="color: #302827; padding: 1em; width: 95%">

        <h1 class="Application-Info">Hyper Ledger Fabric       :       Trade Finance Application       :       Gems Diamonds</h1>

        <br /><br />

        <div class="Hyper-Ledger-Container" style="width: 30%">
            <img src="HyperLedgerFabric.png" alt="Hyper Ledger Fabric" />
        </div>

        <label id="buffer" style="padding-right:10px; float:left">-</label>

        <div class="Smart-Contract-Container" style="width: 30%">
            <img src="SmartContract.jpg" alt="Smart Contract" />
        </div>

        <label id="buffer" style="padding-right:10px; float:left">-</label>

        <div class="Project-Theme-Container" style="width: 30%">
            <img src="GemsAndDiamonds.jpg" alt="Gems And Diamonds" />
        </div>

    </div>

    <div id="Signup-Popup" class="modal">
        <span onclick="document.getElementById('Signup-Popup').style.display='none'" class="close" title="Close Modal">&times;</span>
        <!--form class="modal-content" action="./TradeFinanceHome.html"-->
        <form class="modal-content">
            <div class="container">

                <h1 class="SignUp-Label">Sign Up</h1>
                <p class="SignUp-Label">Please fill in this form to create an account.</p>
                <hr>

                <label class="SignUp-Label" for="Type"><b>UserType</b></label>

                <select name="Type" class="dropdown" required id="User-Type">
                    <option value="Select">Select</option>
                    <option value="Buyer">Buyer</option>
                    <option value="Seller">Seller</option>
                    <option value="Bank">Bank</option>
                </select>

                <label class="SignUp-Label" for="Name"><b>Name</b></label>
                <input type="text" placeholder="Enter Name" name="Name" required id="User-Name">
                <label class="SignUp-Label" for="Location"><b>Location</b></label>
                <input type="text" placeholder="Enter Location" name="Location" required id="User-Location">
                <label class="SignUp-Label" for="Email"><b>Email</b></label>
                <input type="text" placeholder="Enter Email" name="email" required id="User-Email">

                <label class="SignUp-Label" for="UserAddress"><b>UserAddress</b></label>
                <input type="text" placeholder="Enter User Address" name="UserAddress" required id="User-Address">

                <label class="SignUp-Label" for="UserName"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" name="Username" required id="User-UserName">

                <label class="SignUp-Label" for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" name="psw" required id="User-Password">

                <label class="SignUp-Label" for="psw-repeat"><b>Repeat Password</b></label>
                <input type="password" placeholder="Repeat Password" name="psw-repeat" required id="User-RepeatPassword">

                <label>
                    <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
                </label>

                <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>

                <div class="Singup-Controls-Container">

                    <button type="button" class="signupbtn" id="Signup-Button" onclick='processUserRegistration(event);'>Sign Up</button>
                    <label class="buffer-clearance"></label>
                    <button type="button" onclick="document.getElementById('Signup-Popup').style.display='none'" class="cancelbtn">Cancel</button>
                    <label class="bottom-buffer-clearance"></label>

                </div>

            </div>

        </form>

    </div>

    <script>


        /****************************************************************************************
            Close the modal popup for various events
        *****************************************************************************************/

        // Get the modal

        var bDebug = false;

        var modal = document.getElementById('Login-Popup');
        var modalSignup = document.getElementById('Signup-Popup');

        /****************************************************************************************
            When the user clicks anywhere outside of the modal, close it
        *****************************************************************************************/

        window.onclick = function (event) {

            if (event.target == modal) {
                modal.style.display = "none";
            }
            else if (event.target == modalSignup) {
                modalSignup.style.display = "none";
            }

        }

        /****************************************************************************************
            Login & Logout functionality : Hide and display the Internal content references
        *****************************************************************************************/

        window.onload = function (event) {

            document.getElementById("Content-Navigation-bar").style.display = "none";
        }

        /****************************************************************************************
            User Registration : Signup the User with the details Provided
        *****************************************************************************************/

        function processUserRegistration(event) {

            var todaysDate = new Date();
            var uniqueUserId = "UserId_" + todaysDate.getYear().toString() + todaysDate.getMonth().toString() + todaysDate.getDate().toString() + todaysDate.getHours().toString() + todaysDate.getMinutes().toString() + todaysDate.getSeconds().toString();

            // Prepare Http Request from Form data for User Registration

            alert("Raising registration request");

            var userId_Value = uniqueUserId;
            var userType_Value = document.getElementById("User-Type").value;
            var name_Value = document.getElementById("User-Name").value;
            var location_Value = document.getElementById("User-Location").value;
            var email_Value = document.getElementById("User-Email").value;
            var address_Value = document.getElementById("User-Address").value;
            var userName_Value = document.getElementById("User-UserName").value;
            var password_Value = document.getElementById("User-Password").value;
            var repeatPassword_Value = document.getElementById("User-RepeatPassword").value;

            if (userId_Value == null || userType_Value == null || name_Value == null || location_Value == null
                || email_Value == null || userName_Value == null || password_Value == null || repeatPassword_Value == null) {

                alert("one or many of the required input values are missing for User Registration : please try again");
                return;
            }

            if (password_Value != repeatPassword_Value) {

                alert("Passwords did not confirm with each other : please try again");
                return;
            }

            if (address_Value == null || address_Value == undefined) {
                address_Value = "Default_Address";
            }

            // Save the details in mongoDb

            var userRegistration_Keys = ["UserType", "User_Id", "Name", "Location", "Email", "Address", "UserName", "Password"];
            var userRegistration_Values = [userType_Value, userId_Value, name_Value, location_Value, email_Value, address_Value, userName_Value, password_Value];
            var userRegistrationRecord = new Map();

            for (var index = 0; index < userRegistration_Keys.length; index++) {
                userRegistrationRecord.set(userRegistration_Keys[index], userRegistration_Values[index]);
            }

            var Client_Request = "UserRegistration";
            registerUser_MongoDB(userRegistrationRecord, Client_Request);

            // Return to Home-Page after capturing the User Registration input details
            document.getElementById("Signup-Popup").style.display = "none";

        }


        /****************************************************************************************
            User Registration : Register the user in Mongo DB
        *****************************************************************************************/

        function registerUser_MongoDB(userRegistrationRecord, Client_Request) {

            var webServerPrefix = "http://127.0.0.1:3500/?"
            var xmlhttp;
            var httpRequestString = webServerPrefix;

            xmlhttp = new XMLHttpRequest();
            httpRequestString += "Client_Request=" + Client_Request;

            var userRegistrationKeys = userRegistrationRecord.keys();

            for (var currentKey of userRegistrationKeys) {

                httpRequestString += "&"
                httpRequestString += currentKey + "=" + userRegistrationRecord.get(currentKey);
            }

            xmlhttp.open("POST", httpRequestString, true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.setRequestHeader("accept", "application/json");

            // Wait for Async response and Handle it in web page

            xmlhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {

                    //Parse the JSON Response Object

                    responseObject = JSON.parse(this.responseText);

                    alert(" Request Content: " + responseObject.Request);
                    alert(" Status Content: " + responseObject.Status);

                } else {

                    alert("Received response for userRegistration call :=> Status : " + this.status + " readyState : " + this.readyState);
                }

            };

            if (bDebug == true) {

                alert("Saving the user registration detais in mongoDB => httpRequest : " + httpRequestString);
            }

            xmlhttp.send();

        }

        /****************************************************************************************
            User Logoff : Logoff from current session
                        : Redirect to Home Page
        *****************************************************************************************/

        function processLogoff(event) {

            if (bDebug == true) {

                alert("Logging out from TF Website");
            }

            document.getElementById("Content-Navigation-bar").style.display = "none";
            document.getElementById("Login-Navigation-bar").style.display = "initial";
            document.location.replace("./TradeFinanceHome.html");
        }

        /****************************************************************************************
            User Authentication : Authenticate the User using input credentials
        *****************************************************************************************/

        function processUserAuthentication(event) {

            // Prepare Http Request from Form data for User Authentication

            if (bDebug == true) {

                alert("Authentication Request for Current User");
            }

            var userName_Value = document.getElementById("Authentication-UserName").value;
            var password_Value = document.getElementById("Authentication-Password").value;

            if (userName_Value == null || password_Value == null) {

                alert("One of UserName/Password are null : please try again");
                return;
            }

            // Save the details in mongoDb

            var userAuthentication_Keys = ["UserName", "Password"];
            var userAuthentication_Values = [userName_Value, password_Value];
            var userAuthenticationRecord = new Map();

            for (var index = 0; index < userAuthentication_Keys.length; index++) {
                userAuthenticationRecord.set(userAuthentication_Keys[index], userAuthentication_Values[index]);
            }

            var Client_Request = "UserAuthentication";
            authenticateUser_MongoDB(userAuthenticationRecord, Client_Request);

            // Return to Home-Page after capturing the User Authentication input details
            document.getElementById("Login-Popup").style.display = "none";

        }


        /****************************************************************************************
            User Authentication : Authenticate the user in Mongo DB
        *****************************************************************************************/

        function authenticateUser_MongoDB(userAuthenticationRecord, Client_Request) {

            var webServerPrefix = "http://127.0.0.1:3500/?"
            var xmlhttp;
            var httpRequestString = webServerPrefix;

            xmlhttp = new XMLHttpRequest();
            httpRequestString += "Client_Request=" + Client_Request;

            var userAuthenticationKeys = userAuthenticationRecord.keys();

            for (var currentKey of userAuthenticationKeys) {

                httpRequestString += "&"
                httpRequestString += currentKey + "=" + userAuthenticationRecord.get(currentKey);
            }

            xmlhttp.open("POST", httpRequestString, true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.setRequestHeader("accept", "application/json");

            // Wait for Async response and Handle it in web page

            xmlhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {

                    //Parse the JSON Response Object

                    responseObject = JSON.parse(this.responseText);

                    if (bDebug == true) {

                        alert(" Request Content: " + responseObject.Request);
                        alert(" Status Content: " + responseObject.Status);
                    }

                    if (responseObject.Request == "UserAuthentication" && responseObject.Status == "Authentication Successful") {

                        if (bDebug == true) {

                            alert("Logging in to TF Website");
                        }

                        document.getElementById("Content-Navigation-bar").style.display = "initial";
                        document.getElementById("Login-Navigation-bar").style.display = "none";
                    }

                } else if (this.status == 200) {

                    if (bDebug == true) {

                        alert("Received intermediary success response for userAuthentication call :=> Status : " + this.status + " readyState : " + this.readyState);
                    }

                } else {

                    alert("Received failure response for userAuthentication call :=> Status : " + this.status + " readyState : " + this.readyState);
                }

            };

            if (bDebug == true) {

                alert("User Authentication Request => httpRequest : " + httpRequestString);
            }

            xmlhttp.send();
        }

    </script>

</body>

</html>


